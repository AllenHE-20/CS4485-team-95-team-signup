<!DOCTYPE html>
<html lang="en">
<%- include("partials/doc-head.ejs", {title: "Manage Projects"}); %>
<body>

<%- include('partials/header.ejs'); %>

<div class="function-container">
    <div class="function-item">
        <button class="goback-button" onclick="goBack()">Previous Page</button>
    </div>
    <div class="function-item">
        <button class="addteam-button" onclick="openAddProjectModal()">Add New Project</button>
    </div>
</div>

<main class="adminPage">
    <article>
        <ul class="profile-list" id="projectList">
            <% projects.forEach(project=> { %>
                <li class="profile-item" style="display: block;">
                    <div>
                        <div class="profile-image-box">
                            <script>
                                console.log("<%= project.avatar %>");
                            </script>
                            <img class="profile-image" src="/images/<%= project.avatar %>" />
                        </div>
                        <div class="profile-box">
                            <h2 class="project-name">
                                <%= project.projectname %>
                            </h2>
                            <div class="project-sponsor">
                                <%= project.affiliation %> - <%= project.sponsor %>
                            </div>
                            <div class="project-description-1">
                                Project <%= project.projectID %><br>
                                <div class="project-teamsize">
                                    Team Size: <%= project.teamSize %>
                                    <% if (project.maxTeams > project.teamSize) { %>
                                         - <%= project.maxTeams %>
                                    <% } %>
                                </div>
                            </div>
                            <div class="project-description">
                                <%= project.description %>
                            </div>
                            <div class="project-skills inline-list">
                                <%- include("partials/labeled-list.ejs", { label: "Skills needed" , list:
                                    project.skills || []}); %>
                            </div>
                            <div class="project-status-box">
                                <script>
                                    console.log("<%= project.team_assigned %>");
                                </script>
                                Project Status:
                                <% if (!project.team_assigned) { %>
                                <span class="project-status-open">Open</span>
                                <% } else { %>
                                <span class="project-status-closed">Closed</span>
                                <% } %>
                            </div>
                            <div class="adminEditButtons">
                                <div class="editProject">
                                    <button class="editProjectButton" onclick="editProject('<%= project.projectID %>')">Edit Project</button>
                                </div>
                                <div class="removeProject">
                                    <button class="removeProjectButton" onclick="removeProject('<%= project.projectname %>')">Remove Project</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            <% }) %>
        </ul>
    </article>
</main>

<div id="addProjectModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeAddProjectModal()">&times;</span>
        <h2>Add New Project</h2>
        <form id="projectForm">
            <div class="project-content">
                <label for="newProjectName">Project Name</label>
                <input type="text" id="projectName" name="projectName" required><br><br>

                <label for="newProjectSponsor">Sponsor</label>
                <input type="text" id="newSponsor" name="newSponsor" required><br><br>
                
                <label for="newMaxSize">Max Team Size</label>
                <input type="text" id="newSize" name="newSize" required><br><br>

                <label for="newProjectSkills">Skills</label>
                <div class="skill-bubbles" id="skillBubbles"></div>
                <div class="newSkillButtons">
                    <div class="add-skill-newproj">
                        <input type="text" id="newSkillInputAdd" name="skill" placeholder="Enter a skill to add" />
                        <button type="button" id="addSkillButton" onclick="addSkillBubble()">Add Skill</button>
                    </div>
                    <div class="remove-skill-newproj">
                        <input type="text" id="newSkillInputRemove" name="skill" placeholder="Enter a skill to remove" />
                        <button type="button" id="removeSkillButton" onclick="removeSkillBubble(document.getElementById('newSkillInputRemove').value)">Remove Skill</button>
                    </div>
                </div>
            </div>

            <div class="description-content">
                <label for="newProjectDescripton">Description</label>
                <textarea id="newDescription" name="newDescription" rows="4" required></textarea><br><br>
            </div>
            <div class="button-container">
                <button type="button" class="submit-button"onclick="submitProject()">Submit</button>
                <button type="button" class="cancel-button"onclick="closeAddProjectModal()">Cancel</button>            
            </div>
        </form>
    </div>
</div>

<div id="editProjectModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditProjectModal()">&times;</span>
        <h2>Edit Project</h2>
        <form id="projectForm">
            <div class="project-content">
                <label for="editProjectName">Project Name</label>
                <input type="text" id="editProjectName" name="editProjectName" required value="Example Project Name"><br><br>
    
                <label for="editSponsor">Sponsor</label>
                <input type="text" id="editSponsor" name="editSponsor" required value="Example Sponsor"><br><br>
                
                <label for="editMaxSize">Max Team Size</label>
                <input type="text" id="editMaxSize" name="editMaxSize" required value="5"><br><br>
    
                <label for="editProjectSkills">Skills</label>
                <div class="skill-bubbles" id="editSkillBubbles">
    
                </div>
                <div class="newSkillButtons">
                    <div class="add-skill-newproj">
                        <input type="text" id="newSkillInputAdd" name="skill" placeholder="Enter a skill to add" />
                        <button type="button" id="addSkillButton" onclick="editSkillBubble()">Add Skill</button>
                    </div>
                    <div class="remove-skill-newproj">
                        <input type="text" id="newSkillInputRemove" name="skill" placeholder="Enter a skill to remove" />
                        <button type="button" id="removeSkillButton" onclick="editSkillBubble(document.getElementById('newSkillInputRemove').value)">Remove Skill</button>
                    </div>
                </div>
            </div>
            <div class="description-content">
                <label for="editDescription">Description</label>
                <textarea id="editDescription" name="editDescription" rows="4" required>Example Description</textarea><br><br>
            </div>
            <div class="button-container">
                <button type="button" class="submit-button"onclick="submitEditedProject()">Submit</button>
                <button type="button" class="cancel-button"onclick="closeEditProjectModal()">Cancel</button>            </div>
        </form>
    </div>
</div>

<div id="confirmDeleteModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeConfirmDeleteModal()">&times;</span>
        <h2>Confirm Deletion</h2>
        <p id="deleteMessage"></p>
        <div class="button-container">
            <button class="delete-button" type="button" onclick="deleteProject()">Delete</button>
            <button class="cancel-button" type="button" onclick="closeConfirmDeleteModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
    function goBack() {
        window.history.back();
    }

    function editProject(projectID) {
    const modal = document.getElementById("editProjectModal");
    modal.style.display = "block";

    const projectName = "Example Project";
    const sponsor = "Example Sponsor";
    const maxSize = 5;
    const skills = ["Skill 1", "Skill 2"];
    const description = "Example Description";

    document.getElementById("editProjectName").value = projectName;
    document.getElementById("editSponsor").value = sponsor;
    document.getElementById("editMaxSize").value = maxSize;
    document.getElementById("editDescription").value = description;

    const skillBubblesContainer = document.getElementById('editSkillBubbles');
    skillBubblesContainer.innerHTML = '';
    skills.forEach(skill => {
        const skillBubble = document.createElement('div');
        skillBubble.classList.add('skill-bubble');
        skillBubble.textContent = skill;
        skillBubblesContainer.appendChild(skillBubble);
    });
}

    function openAddProjectModal() {
        const modal = document.getElementById("addProjectModal");
        modal.style.display = "block";
    }

    function closeAddProjectModal() {
        const modal = document.getElementById("addProjectModal");
        modal.style.display = "none";
    }

    function closeEditProjectModal() {
        const modal = document.getElementById("editProjectModal");
        modal.style.display = "none";
    }

    function closeConfirmDeleteModal() {
        const modal = document.getElementById("confirmDeleteModal");
        modal.style.display = "none";
    }

    function removeProject(projectName) {
        const modal = document.getElementById("confirmDeleteModal");
        const deleteMessage = document.getElementById("deleteMessage");
        deleteMessage.textContent = `Are you sure you would like to delete Project (${projectName})?`;
        modal.style.display = "block";
    }

    function deleteProject() {
        // TODO: Delete project from database //
        closeConfirmDeleteModal();
    }

    function submitEditedProject() {
        // TODO: Update database by editing project //
    }

    function submitProject() {
        // TODO: Update database by adding project //
        closeAddProjectModal();
    }

    function addSkillBubble() {
        const skillInput = document.getElementById('newSkillInputAdd');
        const skill = skillInput.value.trim();
        if (skill !== '') {
            const skillBubblesContainer = document.getElementById('skillBubbles');
            const skillBubble = document.createElement('div');
            skillBubble.classList.add('skill-bubble');
            skillBubble.textContent = skill;
            skillBubblesContainer.appendChild(skillBubble);
            skillInput.value = '';
        }
}

    function removeSkillBubble(skill) {
        const skillBubbles = document.querySelectorAll('.skill-bubble');
        skillBubbles.forEach(skillBubble => {
            if (skillBubble.textContent === skill) {
                skillBubble.remove();
            }
        });
    }
</script>

</body>
</html>